{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Simulador Inversure</title>

    <script>
        function calcularAutomaticos() {
            const precio = parseFloat(document.getElementById("precio_compra").value) || 0;

            const itp = precio * 0.02;
            const notaria = precio * 0.002;
            const registro = precio * 0.002;

            document.getElementById("itp_auto").innerText = itp.toFixed(2) + " ‚Ç¨";
            document.getElementById("notaria_auto").innerText = notaria.toFixed(2) + " ‚Ç¨";
            document.getElementById("registro_auto").innerText = registro.toFixed(2) + " ‚Ç¨";
        }
    </script>
</head>

<body>

<!-- LOGO -->
<div style="margin-bottom:20px;">
    <img src="{% static 'core/logo_inversure.png' %}" alt="Inversure" style="max-height:80px;">
</div>

<h1>Simulador de operaciones ¬∑ Inversure</h1>

<form method="post">
{% csrf_token %}

<!-- ===================== -->
<h2>1Ô∏è‚É£ Datos principales</h2>
<!-- ===================== -->
Precio compra:
<input type="number" step="0.01" id="precio_compra" name="precio_compra" oninput="calcularAutomaticos()"><br>

Precio venta:
<input type="number" step="0.01" name="precio_venta"><br>

Meses operaci√≥n:
<input type="number" step="1" name="meses"><br>

% Financiaci√≥n:
<input type="number" step="0.01" name="financiacion"><br>

<!-- ===================== -->
<h2>2Ô∏è‚É£ Gastos autom√°ticos de adquisici√≥n</h2>
<!-- ===================== -->
<p>ITP (2 %): <strong id="itp_auto">0.00 ‚Ç¨</strong></p>
<p>Notar√≠a (0,2 %): <strong id="notaria_auto">0.00 ‚Ç¨</strong></p>
<p>Registro (0,2 %): <strong id="registro_auto">0.00 ‚Ç¨</strong></p>

<!-- ===================== -->
<h2>3Ô∏è‚É£ Gastos de adquisici√≥n adicionales</h2>
<!-- ===================== -->
Gestor√≠a compra: <input type="number" step="0.01" name="gestoria_compra"><br>
Captaci√≥n / reservas: <input type="number" step="0.01" name="comisiones_captacion"><br>
Otros gastos adquisici√≥n: <input type="number" step="0.01" name="otros_adquisicion"><br>

<!-- ===================== -->
<h2>4Ô∏è‚É£ Inversi√≥n inicial</h2>
<!-- ===================== -->
Reforma: <input type="number" step="0.01" name="reforma"><br>
Limpieza inicial: <input type="number" step="0.01" name="limpieza_inicial"><br>
Mobiliario: <input type="number" step="0.01" name="mobiliario"><br>
Otros puesta en marcha: <input type="number" step="0.01" name="otros_puesta_marcha"><br>

<!-- ===================== -->
<h2>5Ô∏è‚É£ Gastos recurrentes</h2>
<!-- ===================== -->
Comunidad: <input type="number" step="0.01" name="comunidad"><br>
IBI: <input type="number" step="0.01" name="ibi"><br>
Seguros: <input type="number" step="0.01" name="seguros"><br>
Suministros: <input type="number" step="0.01" name="suministros"><br>
Limpieza peri√≥dica: <input type="number" step="0.01" name="limpieza"><br>
Ocupas / incidencias: <input type="number" step="0.01" name="ocupas"><br>
Otros recurrentes: <input type="number" step="0.01" name="otros_recurrentes"><br>

<!-- ===================== -->
<h2>6Ô∏è‚É£ Gastos de venta</h2>
<!-- ===================== -->
Plusval√≠a municipal: <input type="number" step="0.01" name="plusvalia"><br>
Inmobiliaria: <input type="number" step="0.01" name="inmobiliaria"><br>
Gestor√≠a venta: <input type="number" step="0.01" name="gestoria_venta"><br>
Otros gastos venta: <input type="number" step="0.01" name="otros_venta"><br>

<br>
<button type="submit">Calcular operaci√≥n</button>
</form>

{% if result %}
<hr>

<h2>üìä Resultados econ√≥micos</h2>

<p><strong>Inversi√≥n total:</strong> {{ result.inversion_total }} ‚Ç¨</p>
<p><strong>Beneficio bruto:</strong> {{ result.beneficio_bruto }} ‚Ç¨</p>

<hr>

<h2>üè¢ Resultado Inversure</h2>

<p>Beneficio Inversure (40 %): {{ result.beneficio_inversure }} ‚Ç¨</p>
<p>Gastos administraci√≥n (5 %): {{ result.gastos_administracion }} ‚Ç¨</p>
<p>Gastos comerciales (5 %): {{ result.gastos_comerciales }} ‚Ç¨</p>

<p><strong>Beneficio neto Inversure:</strong> {{ result.beneficio_neto_inversure }} ‚Ç¨</p>

<hr>

<h2>üë• Resultado part√≠cipes</h2>

<p>Beneficio part√≠cipes (60 %): {{ result.beneficio_participes }} ‚Ç¨</p>
<p>Rentabilidad total: {{ result.rentabilidad_total }} %</p>
<p>Rentabilidad anualizada: {{ result.rentabilidad_anualizada }} %</p>

<hr>

<h2>Indicadores clave Inversure</h2>

<div style="padding:15px;
background-color:{% if result.cumple_roi %}#e6f4ea{% else %}#fdecea{% endif %};
border:2px solid {% if result.cumple_roi %}#2e7d32{% else %}#c62828{% endif %};">

ROI m√≠nimo exigido ({{ result.roi_objetivo }} %)<br>
Rentabilidad obtenida: <strong>{{ result.rentabilidad_total }} %</strong><br><br>

{% if result.cumple_roi %}
‚úî Operaci√≥n APTA seg√∫n criterios Inversure
{% else %}
‚úñ Operaci√≥n NO APTA
{% endif %}
</div>

<p>‚öñÔ∏è Ratio beneficio / coste: {{ result.ratio_beneficio_coste }}</p>
<p>üí∞ Precio m√≠nimo de venta (break-even): {{ result.precio_breakeven }} ‚Ç¨</p>
<p>üõ°Ô∏è Colch√≥n de seguridad: {{ result.colchon_seguridad }} ‚Ç¨</p>

{% endif %}

</body>
</html>
