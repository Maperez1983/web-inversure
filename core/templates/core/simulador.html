{% extends "core/base.html" %}
{% load humanize %}
{% block title %}Inversure ¬∑ Simulador{% endblock %}

{% block content %}
  <h1 class="page-title">Simulador de operaciones</h1>
  <p class="page-subtitle">Introduce los datos para calcular rentabilidad y m√©tricas clave.</p>

  <form method="post">
    {% csrf_token %}

    <div class="card">
      <h2>1Ô∏è‚É£ Datos principales</h2>
      <div class="grid">
        <div class="field">
          <label>Precio compra</label>
          <input type="number" step="0.01" name="precio_compra">
        </div>
        <div class="field">
          <label>Precio venta</label>
          <input type="number" step="0.01" name="precio_venta">
        </div>
        <div class="field">
          <label>Meses de la operaci√≥n</label>
          <input type="number" step="1" name="meses">
        </div>
        <div class="field">
          <label>% Financiaci√≥n</label>
          <input type="number" step="0.01" name="financiacion">
        </div>
      </div>
    </div>

    <div class="card mb-4">
    <div class="card-header fw-semibold">
        2Ô∏è‚É£ Gastos de adquisici√≥n
        <span class="text-muted fw-normal">(notar√≠a y registro autom√°ticos)</span>
    </div>

    <div class="card-body row g-3">

        <div class="col-md-3">
    <label class="form-label">
        Notar√≠a (0,20 %)
    </label>
    <input type="text"
           name="notaria"
           id="notaria"
           class="form-control"
           data-euro
           readonly>
    <small class="text-muted">Calculado autom√°ticamente</small>
</div>

<div class="col-md-3">
    <label class="form-label">
        Registro (0,20 %)
    </label>
    <input type="text"
           name="registro"
           id="registro"
           class="form-control"
           data-euro
           readonly>
    <small class="text-muted">Calculado autom√°ticamente</small>
</div>

        <div class="col-md-3">
            <label class="form-label">Gestor√≠a</label>
            <input type="text" name="gestoria" class="form-control" data-euro>
        </div>

        <div class="col-md-3">
            <label class="form-label">Otros gastos</label>
            <input type="text" name="otros_gastos" class="form-control" data-euro>
        </div>

    </div>
</div>

    <div class="card">
      <h2>3Ô∏è‚É£ Inversi√≥n inicial</h2>
      <div class="grid">
        <div class="field">
          <label>Reforma</label>
          <input type="number" step="0.01" name="reforma">
        </div>
        <div class="field">
          <label>Limpieza inicial</label>
          <input type="number" step="0.01" name="limpieza_inicial">
        </div>
        <div class="field">
          <label>Mobiliario</label>
          <input type="number" step="0.01" name="mobiliario">
        </div>
        <div class="field">
          <label>Otros puesta en marcha</label>
          <input type="number" step="0.01" name="otros_puesta_marcha">
        </div>
      </div>
    </div>

    <div class="card">
      <h2>4Ô∏è‚É£ Gastos recurrentes</h2>
      <div class="grid">
        <div class="field">
          <label>Comunidad</label>
          <input type="number" step="0.01" name="comunidad">
        </div>
        <div class="field">
          <label>IBI</label>
          <input type="number" step="0.01" name="ibi">
        </div>
        <div class="field">
          <label>Seguros</label>
          <input type="number" step="0.01" name="seguros">
        </div>
        <div class="field">
          <label>Suministros</label>
          <input type="number" step="0.01" name="suministros">
        </div>
        <div class="field">
          <label>Limpieza peri√≥dica</label>
          <input type="number" step="0.01" name="limpieza_periodica">
        </div>
        <div class="field">
          <label>Ocupas / incidencias</label>
          <input type="number" step="0.01" name="ocupas">
        </div>
        <div class="field">
          <label>Otros recurrentes</label>
          <input type="number" step="0.01" name="otros_recurrentes">
        </div>
      </div>
    </div>

    <div class="card">
      <h2>5Ô∏è‚É£ Gastos de venta</h2>
      <div class="grid">
        <div class="field">
          <label>Plusval√≠a municipal</label>
          <input type="number" step="0.01" name="plusvalia">
        </div>
        <div class="field">
          <label>Inmobiliaria</label>
          <input type="number" step="0.01" name="inmobiliaria">
        </div>
        <div class="field">
          <label>Gestor√≠a venta</label>
          <input type="number" step="0.01" name="gestoria_venta">
        </div>
        <div class="field">
          <label>Otros gastos venta</label>
          <input type="number" step="0.01" name="otros_venta">
        </div>
      </div>
    </div>

    <div class="actions">
      <button class="btn" type="submit">Calcular operaci√≥n</button>
      <span class="pill">ROI m√≠nimo objetivo: 15%</span>
    </div>
  </form>

  {% if resultado %}
    <div class="card">
      <h2>üìä Resultados</h2>

      <div class="kpis">
        <div class="kpi">
          <div class="label">Inversi√≥n total</div>
          <div class="value">{{ resultado.inversion_total|floatformat:2|intcomma }} ‚Ç¨
        </div>
        <div class="kpi">
          <div class="label">Beneficio bruto</div>
          <div class="value">{{ resultado.inversion_total|floatformat:2|intcomma }} ‚Ç¨
        </div>
        <div class="kpi">
          <div class="label">Beneficio part√≠cipes</div>
          <div class="value">{{ resultado.inversion_total|floatformat:2|intcomma }} ‚Ç¨
        </div>
        <div class="kpi">
          <div class="label">Rentabilidad total</div>
          <div class="value">{{ resultado.rentabilidad|floatformat:2 }} %
        </div>
      </div>

      <div class="kpis" style="margin-top:12px;">
        <div class="kpi">
          <div class="label">Rentabilidad anualizada</div>
          <div class="value">{{ resultado.rentabilidad|floatformat:2 }} %
        </div>
        <div class="kpi">
          <div class="label">Ratio beneficio / coste</div>
          <div class="value">{{ resultado.inversion_total|floatformat:2|intcomma }} ‚Ç¨
        </div>
        <div class="kpi">
          <div class="label">Break-even</div>
          <div class="value">{{ resultado.inversion_total|floatformat:2|intcomma }} ‚Ç¨
        </div>
        <div class="kpi">
          <div class="label">Colch√≥n de seguridad</div>
          <div class="value">{{ resultado.inversion_total|floatformat:2|intcomma }} ‚Ç¨
        </div>
      </div>
    </div>
  {% endif %}
{% endblock %}
