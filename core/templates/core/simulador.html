{% extends "core/base.html" %}
{% load static humanize %}


{% block content %}


{% csrf_token %}
<form method="POST" id="form-estudio" onsubmit="return false;">
{% if estudio %}
    <input type="hidden" id="estudio_id" name="estudio_id" value="{{ estudio.id }}">
{% endif %}

<div class="main-container simulador-page">
    <div class="container mt-5">

  <!-- CABECERA PRODUCTO -->
  <div class="card card-inversure shadow-sm border-0 mb-4">
    <div class="card-body d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
      <div>
        <h1 class="mb-1">Estudio de inversi√≥n</h1>
        {% if estudio and estudio.id %}
          <div class="mt-2">
            <span class="badge bg-light text-dark fw-semibold">
              ESTUDIO ¬∑ EST-{{ estudio.id|stringformat:"06d" }}
            </span>
          </div>
        {% endif %}
        <p class="text-muted mb-0">
          An√°lisis t√©cnico, validaci√≥n de comit√© y resumen inversor en una sola herramienta.
        </p>
      </div>
      <div class="action-panel mt-3 mt-md-0">
        <div class="action-group primary-actions">
          <button type="button" class="btn btn-inversure-primary btn-lg" id="btnConvertirProyecto">
            üîÅ Convertir a proyecto
          </button>
          <button type="button" class="btn btn-inversure-secondary" id="btnGuardarEstudio">
            üíæ Guardar estudio
          </button>
          <div class="action-hint text-muted small mt-1">
            Guarda el estudio o convi√©rtelo en una operaci√≥n real
          </div>
        </div>

        <div class="action-divider my-2"></div>

        <div class="action-group secondary-actions">
          {% if estudio and estudio.id %}
          <button
            type="button"
            class="btn btn-outline-secondary"
            id="btnGenerarPdf"
            data-pdf-url="{% url 'core:pdf_estudio_preview' estudio.id %}">
            üìÑ Generar PDF
          </button>
          {% endif %}
          <a href="{% url 'core:lista_estudio' %}" class="btn btn-link text-decoration-none">
            ‚Üê Volver a estudios
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- IDENTIFICACI√ìN DEL PROYECTO -->
  <div class="card card-inversure shadow-sm border-0 mb-4">
  <div class="card-header bg-inversure-dark text-inversure fw-semibold border-0 d-flex align-items-center gap-2">
    <span class="icon-inversure">üè†</span>
    <span>Datos del inmueble</span>
  </div>
<div class="card-body">
      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label fw-semibold">Nombre del proyecto</label>
          <input type="text" class="form-control" id="nombre_proyecto" name="nombre"
                 value="{{ estudio.nombre|default_if_none:'' }}">
        </div>
        <div class="col-md-5">
          <label class="form-label fw-semibold">Direcci√≥n completa</label>
          <input type="text" class="form-control" id="direccion_completa" name="direccion"
                 value="{{ estudio.direccion|default_if_none:'' }}">
        </div>
        <div class="col-md-3">
          <label class="form-label fw-semibold">Referencia catastral</label>
          <input type="text" class="form-control" id="referencia_catastral" name="ref_catastral"
                 value="{{ estudio.ref_catastral|default_if_none:'' }}">
        </div>
      </div>
      <div class="row g-3 mt-1">
        <div class="col-md-4">
          <label class="form-label fw-semibold">Valor de referencia</label>
          <input type="text" class="form-control currency-input" id="valor_referencia" name="valor_referencia"
                 inputmode="decimal" autocomplete="off"
                 value="{{ estudio.valor_referencia|default_if_none:'' }}">
        </div>
      </div>

      <div class="row g-3 mt-1">
        <div class="col-md-4">
          <label class="form-label fw-semibold">Tipolog√≠a</label>
          <select class="form-select" id="tipologia" name="tipologia">
            <option value="" {% if not estudio.tipologia %}selected{% endif %}>Selecciona‚Ä¶</option>
            <option value="Piso" {% if estudio.tipologia == "Piso" %}selected{% endif %}>Piso</option>
            <option value="√Åtico" {% if estudio.tipologia == "√Åtico" %}selected{% endif %}>√Åtico</option>
            <option value="D√∫plex" {% if estudio.tipologia == "D√∫plex" %}selected{% endif %}>D√∫plex</option>
            <option value="Chalet" {% if estudio.tipologia == "Chalet" %}selected{% endif %}>Chalet</option>
            <option value="Adosado" {% if estudio.tipologia == "Adosado" %}selected{% endif %}>Adosado</option>
            <option value="Unifamiliar" {% if estudio.tipologia == "Unifamiliar" %}selected{% endif %}>Unifamiliar</option>
            <option value="Local" {% if estudio.tipologia == "Local" %}selected{% endif %}>Local</option>
            <option value="Oficina" {% if estudio.tipologia == "Oficina" %}selected{% endif %}>Oficina</option>
            <option value="Solar/Parcela" {% if estudio.tipologia == "Solar/Parcela" %}selected{% endif %}>Solar/Parcela</option>
            <option value="Garaje" {% if estudio.tipologia == "Garaje" %}selected{% endif %}>Garaje</option>
            <option value="Trastero" {% if estudio.tipologia == "Trastero" %}selected{% endif %}>Trastero</option>
            <option value="Otro" {% if estudio.tipologia == "Otro" %}selected{% endif %}>Otro</option>
          </select>
        </div>

        <div class="col-md-4">
          <label class="form-label fw-semibold">Superficie (m¬≤)</label>
          <input type="number" class="form-control" id="superficie_m2" name="superficie_m2"
                 inputmode="decimal" min="0" step="0.01" autocomplete="off"
                 value="{{ estudio.superficie_m2|default_if_none:'' }}">
        </div>

        <div class="col-md-4">
          <label class="form-label fw-semibold">Estado</label>
          <select class="form-select" id="estado" name="estado">
            <option value="" {% if not estudio.estado %}selected{% endif %}>Selecciona‚Ä¶</option>
            <option value="Conservado" {% if estudio.estado == "Conservado" %}selected{% endif %}>Conservado</option>
            <option value="Buen estado" {% if estudio.estado == "Buen estado" %}selected{% endif %}>Buen estado</option>
            <option value="Reformado" {% if estudio.estado == "Reformado" %}selected{% endif %}>Reformado</option>
            <option value="A reformar" {% if estudio.estado == "A reformar" %}selected{% endif %}>A reformar</option>
          </select>
        </div>
      </div>

      <div class="row g-3 mt-1">
        <div class="col-md-4">
          <label class="form-label fw-semibold">Situaci√≥n</label>
          <select class="form-select" id="situacion" name="situacion">
            <option value="" {% if not estudio.situacion %}selected{% endif %}>Selecciona‚Ä¶</option>
            <option value="Libre" {% if estudio.situacion == "Libre" %}selected{% endif %}>Libre</option>
            <option value="Ocupado" {% if estudio.situacion == "Ocupado" %}selected{% endif %}>Ocupado</option>
            <option value="Alquilado" {% if estudio.situacion == "Alquilado" %}selected{% endif %}>Alquilado</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- TABS -->
  <ul class="nav nav-tabs mb-4" id="simuladorTabs" role="tablist">
    <li class="nav-item">
      <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#vista-tecnica" type="button">
        Vista t√©cnica
      </button>
    </li>
    <li class="nav-item">
      <button class="nav-link" data-bs-toggle="tab" data-bs-target="#vista-comite" type="button">
        Vista comit√©
      </button>
    </li>
    <li class="nav-item">
      <button class="nav-link" data-bs-toggle="tab" data-bs-target="#vista-inversor" type="button">
        Vista inversor
      </button>
    </li>
  </ul>

  <div class="tab-content">

    <!-- VISTA TECNICA -->
    <div class="tab-pane fade show active" id="vista-tecnica">

      <div class="card card-inversure shadow-sm border-0 mb-4 inversure-section">
        <div class="card-header bg-inversure-dark text-inversure fw-semibold border-0 d-flex align-items-center gap-2">
          <span class="icon-inversure">üí∂</span>
          <span>Datos de adquisici√≥n</span>
        </div>
        <div class="card-body">

          <div class="row g-3 mb-3">
            <div class="col-md-6">
              <label class="form-label">Precio de escritura</label>
              <input type="text" class="form-control currency-input" id="precio_escritura" name="precio_escritura" inputmode="decimal" autocomplete="off" value="{{ estudio.precio_escritura|default_if_none:'' }}">
            </div>
            <div class="col-md-6">
              <label class="form-label">ITP (2 %)</label>
              <input type="text" class="form-control currency-input" id="itp" name="itp" inputmode="decimal" autocomplete="off" readonly value="{{ estudio.itp|default_if_none:'' }}">
            </div>
          </div>

          <div class="row g-3 mb-3">
            <div class="col-md-6">
              <label class="form-label">Notar√≠a</label>
              <input type="text" class="form-control currency-input" id="notaria" name="notaria" inputmode="decimal" autocomplete="off" value="{{ estudio.notaria|default_if_none:'' }}">
            </div>
            <div class="col-md-6">
              <label class="form-label">Registro</label>
              <input type="text" class="form-control currency-input" id="registro" name="registro" inputmode="decimal" autocomplete="off" value="{{ estudio.registro|default_if_none:'' }}">
            </div>
          </div>

          <div class="row g-3 mb-3">
            <div class="col-md-6">
              <label class="form-label">Gastos extras</label>
              <input type="text" class="form-control currency-input" id="gastos_extras" name="gastos_extras" inputmode="decimal" autocomplete="off" value="{{ estudio.gastos_extras|default_if_none:'' }}">
            </div>
          </div>

          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label fw-bold">Valor de adquisici√≥n</label>
              <input type="text" class="form-control currency-input input-result" id="valor_adquisicion" name="valor_adquisicion" inputmode="decimal" autocomplete="off" readonly value="{{ estudio.valor_adquisicion|default_if_none:'' }}">
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold">Valor de transmisi√≥n</label>
              <input type="text" class="form-control currency-input input-result" id="valor_transmision" name="valor_transmision" inputmode="decimal" autocomplete="off" readonly value="{{ estudio.valor_transmision|default_if_none:'' }}">
            </div>
          </div>

        </div>
      </div>

      <div class="card card-inversure shadow-sm border-0 mb-4 inversure-section">
        <div class="card-header bg-inversure-dark text-inversure fw-semibold border-0 d-flex align-items-center gap-2">
          <span class="icon-inversure">üìà</span>
          <span>Valoraciones de mercado</span>
        </div>
        <div class="card-body">

          <div class="row g-3 mb-3">
            <div class="col-md-4">
              <label class="form-label">Tasaci√≥n</label>
              <input type="text" class="form-control valoracion currency-input" name="valoracion_tasacion" inputmode="decimal" autocomplete="off" value="{{ estudio.valoracion_tasacion|default_if_none:'' }}">
            </div>
            <div class="col-md-4">
              <label class="form-label">Idealista</label>
              <input type="text" class="form-control valoracion currency-input" name="valoracion_idealista" inputmode="decimal" autocomplete="off" value="{{ estudio.valoracion_idealista|default_if_none:'' }}">
            </div>
            <div class="col-md-4">
              <label class="form-label">Fotocasa</label>
              <input type="text" class="form-control valoracion currency-input" name="valoracion_fotocasa" inputmode="decimal" autocomplete="off" value="{{ estudio.valoracion_fotocasa|default_if_none:'' }}">
            </div>
          </div>

          <div class="row g-3 mb-3">
            <div class="col-md-6">
              <label class="form-label">Registradores</label>
              <input type="text" class="form-control valoracion currency-input" name="valoracion_registradores" inputmode="decimal" autocomplete="off" value="{{ estudio.valoracion_registradores|default_if_none:'' }}">
            </div>
            <div class="col-md-6">
              <label class="form-label">Casafari</label>
              <input type="text" class="form-control valoracion currency-input" name="valoracion_casafari" inputmode="decimal" autocomplete="off" value="{{ estudio.valoracion_casafari|default_if_none:'' }}">
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <label class="form-label fw-bold">Media de valoraciones</label>
              <input type="text" class="form-control currency-input input-result" id="media_valoraciones" name="media_valoraciones" inputmode="decimal" autocomplete="off" readonly value="{{ estudio.media_valoraciones|default_if_none:'' }}">
            </div>
          </div>

        </div>
      </div>

    </div>

    <!-- VISTA COMITE -->
    <div class="tab-pane fade" id="vista-comite">
      <div class="row g-4">

        <!-- BLOQUE 1 ¬∑ DECISI√ìN COMIT√â -->
        <div class="col-12">
          <div class="card shadow-sm border-0 mb-3">
            <div class="card-header fw-bold">Decisi√≥n del comit√©</div>
            <div class="card-body">
              <div class="row g-4">

                <div class="col-md-3">
                  <div class="card kpi-card kpi-beneficio text-center shadow-sm">
                    <div class="card-body">
                      <h6 class="text-muted">Beneficio bruto</h6>
                      <p class="fs-3 fw-bold kpi-dinamico" id="kpi_beneficio_bruto">--</p>
                    </div>
                  </div>
                </div>

                <div class="col-md-3">
                  <div class="card kpi-card kpi-roi text-center shadow-sm">
                    <div class="card-body">
                      <h6 class="text-muted">ROI</h6>
                      <p class="fs-3 fw-bold kpi-dinamico" id="kpi_roi">--</p>
                    </div>
                  </div>
                </div>

                <div class="col-md-3">
                  <div class="card kpi-card kpi-riesgo text-center shadow-sm">
                    <div class="card-body">
                      <h6 class="text-muted">Nivel de riesgo</h6>
                      <p class="fs-3 fw-bold" id="kpi_nivel_riesgo">--</p>
                      <div class="d-flex justify-content-center gap-2 mt-2">
                        <span class="semaforo-dot" id="riesgo_bajo"></span>
                        <span class="semaforo-dot" id="riesgo_medio"></span>
                        <span class="semaforo-dot" id="riesgo_alto"></span>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-md-3">
                  <div class="card kpi-card kpi-decision text-center shadow-sm">
                    <div class="card-body">
                      <h6 class="text-muted">Decisi√≥n</h6>
                      <p class="fs-3 fw-bold kpi-semaforo" id="kpi_semaforo">--</p>
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>

        <!-- BLOQUE ¬∑ RESUMEN EJECUTIVO DEL COMIT√â -->
        <div class="col-12">
          <div class="card shadow-sm border-0 mb-3">
            <div class="card-header fw-bold">
              Resumen ejecutivo del comit√©
            </div>
            <div class="card-body">
              <p class="text-muted small mb-2">
                S√≠ntesis final para informes, PDF y presentaci√≥n a socios.
              </p>

              <textarea
                class="form-control"
                id="resumen_ejecutivo_comite"
                name="resumen_ejecutivo_comite"
                rows="3"
                maxlength="600"
                placeholder="Ejemplo: Operaci√≥n con ROI atractivo, margen suficiente y riesgo controlado. El comit√© recomienda su aprobaci√≥n."></textarea>

              <div class="form-text text-muted mt-1">
                Este texto se usar√° directamente en el PDF del estudio.
              </div>
            </div>
          </div>
        </div>

        <!-- BLOQUE ¬∑ VALORACI√ìN DEL COMIT√â -->
        <div class="col-12">
          <div class="card shadow-sm border-0 mb-3">
            <div class="card-header fw-bold">
              Valoraci√≥n del comit√©
            </div>
            <div class="card-body">
              <div class="row g-3">

                <div class="col-md-3">
                  <label class="form-label fw-semibold">Mercado</label>
                  <select class="form-select" id="valoracion_mercado" name="valoracion_mercado">
                    <option value="">Selecciona‚Ä¶</option>
                    <option value="muy_favorable">Muy favorable</option>
                    <option value="favorable">Favorable</option>
                    <option value="neutral">Neutral</option>
                    <option value="desfavorable">Desfavorable</option>
                  </select>
                </div>

                <div class="col-md-3">
                  <label class="form-label fw-semibold">Riesgo</label>
                  <select class="form-select" id="valoracion_riesgo" name="valoracion_riesgo">
                    <option value="">Selecciona‚Ä¶</option>
                    <option value="bajo">Bajo</option>
                    <option value="medio">Medio</option>
                    <option value="alto">Alto</option>
                  </select>
                </div>

                <div class="col-md-3">
                  <label class="form-label fw-semibold">Ejecuci√≥n</label>
                  <select class="form-select" id="valoracion_ejecucion" name="valoracion_ejecucion">
                    <option value="">Selecciona‚Ä¶</option>
                    <option value="sencilla">Sencilla</option>
                    <option value="media">Media</option>
                    <option value="compleja">Compleja</option>
                  </select>
                </div>

                <div class="col-md-3">
                  <label class="form-label fw-semibold">Timing</label>
                  <select class="form-select" id="valoracion_timing" name="valoracion_timing">
                    <option value="">Selecciona‚Ä¶</option>
                    <option value="optimo">√ìptimo</option>
                    <option value="adecuado">Adecuado</option>
                    <option value="dudoso">Dudoso</option>
                  </select>
                </div>

                <div class="col-12 mt-2">
                  <label class="form-label fw-semibold">Comentario del comit√© (opcional)</label>
                  <textarea
                    class="form-control"
                    id="comentario_comite"
                    name="comentario_comite"
                    rows="2"
                    maxlength="300"
                    placeholder="Breve justificaci√≥n de la valoraci√≥n del comit√©‚Ä¶"></textarea>
                </div>

              </div>
            </div>
          </div>
        </div>

        <!-- BLOQUE ¬∑ DECISI√ìN FORMAL DEL COMIT√â -->
        <div class="col-12">
          <div class="card shadow-sm border-0">
            <div class="card-header fw-bold">
              Decisi√≥n formal del comit√©
            </div>
            <div class="card-body">
              <div class="row align-items-end g-3">

                <div class="col-md-4">
                  <label class="form-label fw-semibold">Estado del estudio</label>
                  <select class="form-select" id="decision_comite" name="decision_comite" required>
                    <option value="">Selecciona‚Ä¶</option>
                    <option value="aprobada">üü¢ Aprobada</option>
                    <option value="estudio">üü† En estudio</option>
                    <option value="denegada">üî¥ Denegada</option>
                  </select>
                </div>

                <div class="col-md-4">
                  <label class="form-label fw-semibold">Fecha de decisi√≥n</label>
                  <input
                    type="text"
                    class="form-control"
                    id="fecha_decision_comite"
                    name="fecha_decision_comite"
                    readonly
                    placeholder="Pendiente de decisi√≥n">
                </div>

                <div class="col-md-4 text-muted small">
                  Esta decisi√≥n determina si el estudio puede convertirse en proyecto
                  y si se presenta a inversores.
                </div>

              </div>
            </div>
          </div>
        </div>

        <!-- BLOQUE 2 ¬∑ ROBUSTEZ -->
        <div class="col-12">
          <div class="card shadow-sm border-0 mb-3">
            <div class="card-header fw-bold">Robustez de la operaci√≥n</div>
            <div class="card-body">
              <div class="row g-4">

                <div class="col-md-3">
                  <div class="card text-center shadow-sm">
                    <div class="card-body">
                      <h6 class="text-muted">Margen</h6>
                      <p class="fs-4 fw-bold" id="kpi_margen">--</p>
                    </div>
                  </div>
                </div>

                <div class="col-md-3">
                  <div class="card text-center shadow-sm">
                    <div class="card-body">
                      <h6 class="text-muted">Ratio ‚Ç¨ / beneficio</h6>
                      <p class="fs-4 fw-bold" id="kpi_ratio_beneficio">--</p>
                    </div>
                  </div>
                </div>

                <div class="col-md-3">
                  <div class="card text-center shadow-sm">
                    <div class="card-body">
                      <h6 class="text-muted">Colch√≥n de seguridad</h6>
                      <p class="fs-4 fw-bold" id="kpi_colchon_seguridad">--</p>
                    </div>
                  </div>
                </div>

                <div class="col-md-3">
                  <div class="card text-center shadow-sm">
                    <div class="card-body">
                      <h6 class="text-muted">Breakeven</h6>
                      <p class="fs-4 fw-bold" id="kpi_breakeven">--</p>
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>

        <!-- BLOQUE 3 ¬∑ CONTROL -->
        <div class="col-12">
          <div class="card shadow-sm border-0">
            <div class="card-header fw-bold">Control econ√≥mico</div>
            <div class="card-body">
              <div class="row g-4">

                <div class="col-md-6">
                  <div class="card text-center shadow-sm">
                    <div class="card-body">
                      <h6 class="text-muted">Valor de adquisici√≥n</h6>
                      <p class="fs-5 fw-bold" id="kpi_valor_adquisicion">--</p>
                    </div>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="card text-center shadow-sm">
                    <div class="card-body">
                      <h6 class="text-muted">Valor de transmisi√≥n</h6>
                      <p class="fs-5 fw-bold" id="kpi_valor_transmision">--</p>
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- VISTA INVERSOR (RESET LIMPIO) -->
    <div class="tab-pane fade" id="vista-inversor">
      <div class="row g-4">


        <!-- CONDICIONES COMERCIALES ¬∑ COMISI√ìN INVERSURE -->
        <div class="col-12">
          <div class="card shadow-sm border-0 mb-3">
            <div class="card-header fw-bold">
              Condiciones del acuerdo
            </div>
            <div class="card-body">
              <div class="row align-items-center g-3">

                <div class="col-md-4">
                  <label class="form-label fw-semibold">
                    Comisi√≥n Inversure sobre beneficio
                  </label>
                  <select id="inv_porcentaje_comision" class="form-select">
                    <option value="30">30 %</option>
                    <option value="35">35 %</option>
                    <option value="40">40 %</option>
                  </select>
                </div>
<div class="col-md-8">
  <div class="text-muted small">
    La comisi√≥n se descuenta del beneficio bruto antes del reparto al inversor.
  </div>
  <div class="mt-2 fw-semibold">
    Comisi√≥n estimada: <span id="inversor_comision_eur">--</span>
  </div>
</div>

              </div>
            </div>
          </div>
        </div>

        <div class="col-12">
          <div class="card shadow-sm border-0">
            <div class="card-header fw-bold">
              Indicadores clave para el inversor
            </div>
            <div class="card-body">
              <div class="row g-4">

                <div class="col-md-4">
                  <div class="card text-center shadow-sm">
                    <div class="card-body">
                      <h6 class="text-muted">Inversi√≥n total</h6>
                      <p class="fs-4 fw-bold" id="inversor_inversion">--</p>
                    </div>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="card text-center shadow-sm">
                    <div class="card-body">
                      <h6 class="text-muted">Beneficio neto</h6>
                      <p class="fs-4 fw-bold text-success" id="inversor_beneficio_neto">--</p>
                    </div>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="card text-center shadow-sm">
                    <div class="card-body">
                      <h6 class="text-muted">ROI neto</h6>
                      <p class="fs-4 fw-bold" id="inversor_roi_neto">--</p>
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

  </div>

  </div>
</div>

<script src="{% static 'core/simulador.js' %}"></script>
<script>
document.getElementById("btnConvertirProyecto").addEventListener("click", function() {
    const estudioId = document.getElementById("estudio_id")?.value;
    if (!estudioId) {
        alert("No hay estudio para convertir.");
        return;
    }
    fetch("/convertir-proyecto/", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": document.querySelector('[name=csrfmiddlewaretoken]').value,
        },
        body: JSON.stringify({ estudio_id: estudioId }),
    }).then(response => {
        if (response.ok) {
            window.location.href = "/proyectos/";
        } else {
            alert("Error al convertir el estudio.");
        }
    });
});
</script>
</div>
</div>
</form>
<script>
(function () {
  const btn = document.getElementById('btnGenerarPdf');
  if (!btn) return;

  btn.addEventListener('click', function () {
    const url = btn.dataset.pdfUrl;
    if (url) {
      window.location.href = url;
    }
  });
})();
</script>
{% endblock %}