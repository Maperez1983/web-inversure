{% extends "core/base.html" %}
{% load static %}
{% load humanize %}
{% block content %}
<div class="inversure-app">
  <section class="inversure-section">
    <div class="container">

      <section class="inversure-section-header mb-5 text-center">
        <h1 class="inversure-section-title">Estudios</h1>
        <div class="inversure-divider mx-auto"></div>
        <p class="inversure-section-subtitle mx-auto">
          Estudios de viabilidad en fase de análisis
        </p>
      </section>

      {% if estudios %}
      <div class="row g-4">
        {% for estudio in estudios %}
        <div class="col-xl-3 col-lg-4 col-md-6">
          <div class="card h-100 shadow-sm inversure-card">
            <div class="card-header inversure-card-header text-white" style="background-color:#122135;">
              <div class="fw-semibold">
                {{ estudio.nombre|default:"Estudio sin nombre" }}
              </div>
              <div class="small opacity-75">
                {{ estudio.direccion|default:"Sin dirección" }}
              </div>
            </div>

            <div class="card-body d-flex flex-column">
              <span class="badge bg-light text-primary border mb-3 align-self-start">
                En estudio
              </span>

              <div class="row text-center mb-4 inversure-kpis">
                <div class="col-4">
                  <div class="fw-semibold small text-muted">Inversión</div>
                  <div class="fw-bold">{{ estudio.precio_compra|floatformat:0|intcomma }} €</div>
                </div>
                <div class="col-4">
                  <div class="fw-semibold small text-muted">Beneficio</div>
                  <div class="fw-bold">{{ estudio.beneficio|floatformat:0|intcomma }} €</div>
                </div>
                <div class="col-4">
                  <div class="fw-semibold small text-muted">ROI</div>
                  <div class="fw-bold">{{ estudio.roi|floatformat:2 }} %</div>
                </div>
              </div>

              <div class="mt-auto d-flex justify-content-center gap-2">
                <a href="{% url 'core:simulador' estudio.id %}" class="btn btn-primary btn-sm">
                  Abrir
                </a>

                <form method="post" action="{% url 'core:borrar_proyecto' estudio.id %}"
                      onsubmit="return confirm('¿Seguro que quieres borrar este estudio?');">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-outline-danger btn-sm">
                    Borrar
                  </button>
                </form>
              </div>
            </div>

          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
        <div class="text-center text-muted py-5">
          No hay estudios en curso.
        </div>
      {% endif %}

    </div>
  </section>
</div>
<style>
  .inversure-kpis .fw-semibold {
    font-size: 0.85rem;
    white-space: nowrap;
  }

  .inversure-kpis .fw-bold {
    font-size: 0.95rem;
  }
</style>
{% endblock %}